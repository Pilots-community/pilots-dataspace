server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Provider control plane management API
    location /api/provider/ {
        proxy_pass http://provider-controlplane:19193/management/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Consumer control plane management API
    location /api/consumer/ {
        proxy_pass http://consumer-controlplane:29193/management/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Health endpoints
    location /api/health/provider-cp {
        proxy_pass http://provider-controlplane:18181/api/check/health;
    }
    location /api/health/consumer-cp {
        proxy_pass http://consumer-controlplane:28181/api/check/health;
    }
    location /api/health/provider-dp {
        proxy_pass http://provider-dataplane:38181/api/check/health;
    }
    location /api/health/consumer-dp {
        proxy_pass http://consumer-dataplane:48181/api/check/health;
    }
    location /api/health/provider-ih {
        proxy_pass http://provider-identityhub:7090/api/check/health;
    }
    location /api/health/consumer-ih {
        proxy_pass http://consumer-identityhub:7080/api/check/health;
    }

    # SPA fallback
    location / {
        try_files $uri $uri/ /index.html;
    }
}
